(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5695:function(e,t,s){Promise.resolve().then(s.bind(s,6875))},6875:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return j}});var r=s(7437),l=s(2265),n=s(8946),a=s.n(n),i=s(809),o=s(61),d=s(1448),c=s(8478),x=s(7283),p=s(2521),u=s(649);function m(e){let{textureUrl:t,pixelSize:s,origin:n,addVertex:a}=e,i=(0,l.useRef)(null),o=(0,c.H)(d.TextureLoader,t),x=(0,l.useRef)(0),p=(0,l.useRef)(0);return(0,r.jsxs)("mesh",{ref:i,position:[n[0],n[1],-.05],rotation:[0,0,Math.PI/2],onPointerDown:()=>{x.current=Date.now()},onPointerUp:()=>{p.current=Date.now()-x.current},onClick:e=>{if(p.current<=100){let{x:t,y:s}=e.point;a(t,s)}},children:[(0,r.jsx)("planeGeometry",{args:[o.image.width*s,o.image.height*s]}),(0,r.jsx)("meshBasicMaterial",{map:o,transparent:!0,opacity:.2})]})}function g(e){let{vertex:t,active:s,deleteVertex:l,selectVertex:n}=e;return(0,r.jsxs)("mesh",{position:[-1*t.pose.y,t.pose.x,t.pose.z+.25],rotation:[Math.PI/2,0,0],onContextMenu:e=>{e.stopPropagation(),l(t.id)},onClick:e=>{e.stopPropagation(),n(t.id)},children:[(0,r.jsx)("cylinderGeometry",{args:[.6,.6,.5,32]}),(0,r.jsx)("meshStandardMaterial",{color:"green",transparent:!0,opacity:s?1:.5})]})}function h(e){let{start:t,end:s}=e,l=new d.Vector3(-1*t.pose.y,t.pose.x,t.pose.z),n=new d.Vector3(-1*s.pose.y,s.pose.x,s.pose.z),a=l.distanceTo(n),i=new d.Vector3().subVectors(n,l).normalize(),o=new d.Vector3().addVectors(l,n).multiplyScalar(.5),c=Math.atan2(i.y,i.x),x=new d.Vector3(-i.y,i.x,0).normalize().multiplyScalar(.3),p=o.clone().sub(x);return(0,r.jsxs)("mesh",{position:p,rotation:[0,0,c],children:[(0,r.jsx)("planeGeometry",{args:[a,.2]}),(0,r.jsx)("meshStandardMaterial",{color:"green",transparent:!0,opacity:.5})]})}function f(e){let{contents:t,addVertex:s,deleteVertex:n,selectVertex:a,selectedIds:i}=e,[o,c]=(0,l.useState)(null),f=e=>{let t=new u.w;console.log("test"),t.load(e,e=>{let t=e.geometry,s=t.attributes.position,r=new Float32Array(3*s.count),l=new d.Color("blueviolet");for(let e=0;e<s.count;e++)r[3*e]=l.r,r[3*e+1]=l.g,r[3*e+2]=l.b;t.setAttribute("color",new d.BufferAttribute(r,3));let n=new d.PointsMaterial({size:.05,vertexColors:!0});e.material=n,c(e)},void 0,e=>{console.error("Error loading PCD file:",e)})};return(0,l.useEffect)(()=>{f("/map.pcd")},[]),(0,r.jsxs)(x.Xz,{children:[(0,r.jsx)("ambientLight",{intensity:Math.PI/2}),(0,r.jsx)("pointLight",{position:[-10,-10,-10],decay:0,intensity:Math.PI}),(0,r.jsx)("gridHelper",{args:[200,200,"black","#d3d3d3"],rotation:[Math.PI/2,0,0],position:[0,0,-.04]}),o&&(0,r.jsx)("primitive",{object:o,rotation:[0,0,Math.PI/2]}),t&&t.vertexs.map(e=>(0,r.jsx)(g,{deleteVertex:n,selectVertex:a,active:i.includes(e.id),vertex:e},e.id)),t&&t.edges.map(e=>{let s=t.vertexs.find(t=>t.id===e.startId),l=t.vertexs.find(t=>t.id===e.endId);return s&&l?(0,r.jsx)(h,{start:s,end:l},e.id):null}),(0,r.jsx)(m,{textureUrl:"/map.png",pixelSize:.1,origin:[0,0],addVertex:s}),(0,r.jsx)(p.z,{})]})}var v=s(8238),y=s(11),b=s(2658);function j(){let[e,t]=(0,l.useState)(!1),[s,n]=(0,l.useState)([]),[d,c]=(0,l.useState)({vertexs:[],edges:[]}),x=()=>{if(!d)return"";let e=d.vertexs.length,t=Array(e*e).fill(0);d.edges.forEach(s=>{let r=d.vertexs.findIndex(e=>e.id===s.startId),l=d.vertexs.findIndex(e=>e.id===s.endId);-1!==r&&-1!==l&&(t[r*e+l]=s.weight)});let s={topology_map:{vertexs:d.vertexs.map((e,t)=>({...e,id:t})),edges:t}};return v.ZP.stringify(s)};return(0,l.useEffect)(()=>{if(s.length>=2){var e,t;let r=null!==(t=null===(e=a().maxBy(d.edges,"id"))||void 0===e?void 0:e.id)&&void 0!==t?t:-1,l=a().find(d.edges,{startId:s[0],endId:s[1]});c(e=>({vertexs:e.vertexs,edges:l?e.edges.filter(e=>e.id!==l.id):[...e.edges,{id:r+1,startId:s[0],endId:s[1],weight:1}]})),n([])}},[s]),(0,r.jsxs)("div",{className:"flex justify-center items-center min-h-screen",children:[(0,r.jsxs)("div",{className:"w-[1440px] h-[calc(100vh-40px)] bg-white shadow-lg rounded-lg grid grid-rows-9 grid-cols-3",children:[(0,r.jsx)("div",{className:"row-span-9 col-span-2 bg-gray-200 relative",children:(0,r.jsx)(f,{contents:d,addVertex:(e,t)=>{if(d){var s,r;let l=null!==(r=null===(s=a().maxBy(d.vertexs,"id"))||void 0===s?void 0:s.id)&&void 0!==r?r:-1,i=[...d.vertexs,{id:l+1,pose:{x:t,y:-1*e,z:0,yaw:0},status:"ACTIVE"}];n([]),c({...d,vertexs:i})}},deleteVertex:e=>{if(d){let t=d.vertexs.filter(t=>t.id!==e),s=d.edges.filter(t=>t.startId!==e&&t.endId!==e);n([]),c({...d,vertexs:t,edges:s})}},selectVertex:e=>{n(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},selectedIds:s})}),(0,r.jsxs)("div",{className:"row-span-9 col-span-1 px-4 py-4 flex flex-col justify-between h-full",children:[(0,r.jsxs)(i.v0,{className:"flex flex-col flex-grow overflow-y-auto",children:[(0,r.jsx)(i.td,{className:"flex space-x-0 mb-4",children:[{name:"Vertex"},{name:"Edge"}].map(e=>(0,r.jsx)(i.OK,{className:e=>{let{selected:t}=e;return"flex items-center px-6 py-2 transition-colors border-b-2 ".concat(t?"text-black font-bold border-blue-500":"bg-gray-100 text-black border-transparent")},children:e.name},e.name))}),(0,r.jsxs)(i.nP,{className:"flex-grow overflow-y-auto",children:[(0,r.jsx)(i.x4,{children:d?(0,r.jsx)("div",{className:"space-y-4",children:d.vertexs.map(e=>(0,r.jsxs)("div",{className:"p-4 border rounded-md shadow-sm bg-gray-50 flex flex-col space-y-2",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-blue-600",children:["Vertex ID: ",e.id]}),(0,r.jsxs)("p",{children:["Position: (X: ",e.pose.x,", Y: ",e.pose.y,", Z:"," ",e.pose.z,")"]}),(0,r.jsxs)("p",{children:["Yaw: ",e.pose.yaw]}),(0,r.jsxs)("p",{children:["Status:",(0,r.jsx)("span",{className:"ml-2 px-2 py-1 rounded-md text-sm ".concat("ACTIVE"===e.status?"bg-green-200 text-green-800":"bg-red-200 text-red-800"),children:e.status})]}),(0,r.jsx)("button",{className:"mt-2 px-4 py-1 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors",onClick:()=>{let t=d.vertexs.filter(t=>t.id!==e.id);c({...d,vertexs:t})},children:"Delete"})]},e.id))}):(0,r.jsx)("p",{children:"No vertex data available."})}),(0,r.jsx)(i.x4,{className:"flex-grow overflow-y-auto",children:d?(0,r.jsx)("div",{className:"flex flex-col gap-3",children:d.edges.map(e=>{let t=d.vertexs.find(t=>t.id===e.startId),s=d.vertexs.find(t=>t.id===e.endId);return t&&s?(0,r.jsxs)("div",{className:"p-4 border rounded-md shadow-sm bg-gray-50 flex flex-col space-y-2",children:[(0,r.jsxs)("h4",{className:"text-md font-semibold text-blue-600",children:["Edge between Vertex ",t.id," and Vertex"," ",s.id]}),(0,r.jsxs)("p",{children:["Start Position: (X: ",t.pose.x,", Y:"," ",t.pose.y,", Z: ",t.pose.z,")"]}),(0,r.jsxs)("p",{children:["End Position: (X: ",s.pose.x,", Y:"," ",s.pose.y,", Z: ",s.pose.z,")"]}),(0,r.jsxs)("label",{className:"flex items-center space-x-2 mt-2",children:[(0,r.jsx)("span",{children:"Weight:"}),(0,r.jsx)("input",{type:"number",value:e.weight,onChange:t=>{let s=parseInt(t.target.value,10)||0,r=d.edges.map(t=>t.id===e.id?{...t,weight:s}:t);c({...d,edges:r})},className:"px-2 py-1 border rounded-md w-20"})]})]},e.id):null})}):(0,r.jsx)("p",{children:"No edge data available."})})]})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 my-4",children:[(0,r.jsx)("button",{onClick:()=>{var e;return null===(e=document.getElementById("file-input"))||void 0===e?void 0:e.click()},className:"self-end mt-auto px-6 py-2 bg-gray-200 rounded-md shadow-md hover:bg-gray-400 transition-colors",children:"Load"}),(0,r.jsx)("input",{type:"file",id:"file-input",accept:".yaml, .yml",style:{display:"none"},onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(s){let e=new FileReader;e.onload=e=>{if(e.target&&"string"==typeof e.target.result)try{let t=e.target.result,s=v.ZP.parse(t),r=s.topology_map.vertexs.length,l=s.topology_map.edges.reduce((e,t,s)=>t>0?[...e,{id:s,startId:Math.floor(s/r),endId:s%r,weight:t}]:e,[]);c({vertexs:s.topology_map.vertexs,edges:l}),console.log(s.topology_map.edges)}catch(e){console.error("Error parsing YAML file:",e)}},e.readAsText(s)}}}),(0,r.jsx)("button",{onClick:()=>t(!0),className:"self-end mt-auto px-6 py-2 bg-blue-500 text-white rounded-md shadow-md hover:bg-blue-600 transition-colors",children:"Save"})]})]})]}),(0,r.jsxs)(o.Vq,{open:e,onClose:()=>t(!1),className:"relative z-50",children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,r.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,r.jsxs)(o.EM,{className:"w-full max-w-2xl bg-white rounded-lg p-6 shadow-lg",children:[(0,r.jsx)(o.$N,{className:"text-lg font-bold mb-4",children:"YAML Preview"}),(0,r.jsx)("div",{className:"overflow-y-auto max-h-80 border p-2 rounded",children:(0,r.jsx)(y.Z,{language:"yaml",style:b.Z,children:x()})}),(0,r.jsxs)("div",{className:"mt-4 flex justify-end space-x-2",children:[(0,r.jsx)("button",{onClick:()=>t(!1),className:"px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-300",children:"Close"}),(0,r.jsx)("button",{onClick:()=>{let e=new Blob([x()],{type:"text/yaml"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="topology_map.yaml",t.click(),URL.revokeObjectURL(t.href)},className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"Save to File"})]})]})})]})]})}}},function(e){e.O(0,[689,866,406,971,117,744],function(){return e(e.s=5695)}),_N_E=e.O()}]);